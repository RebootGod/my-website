# Supervisor Configuration for Noobz Cinema Queue Worker
# Location: /etc/supervisor/conf.d/noobz-queue-worker.conf
#
# Installation Instructions for Laravel Forge:
# 1. SSH into server: ssh forge@noobz.space
# 2. Create file: sudo nano /etc/supervisor/conf.d/noobz-queue-worker.conf
# 3. Paste this configuration
# 4. Update supervisor: sudo supervisorctl reread
# 5. Add program: sudo supervisorctl update
# 6. Start worker: sudo supervisorctl start noobz-queue-worker:*
# 7. Check status: sudo supervisorctl status

[program:noobz-queue-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /home/forge/noobz.space/artisan queue:work redis --queue=emails,notifications,analytics,maintenance,default --tries=3 --timeout=120 --sleep=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=forge
numprocs=2
redirect_stderr=true
stdout_logfile=/home/forge/noobz.space/storage/logs/queue-worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stopwaitsecs=60
startsecs=1

# Queue Configuration:
# - emails: High priority for welcome/password reset emails
# - notifications: User and admin notifications
# - analytics: Movie and user analytics processing
# - maintenance: Cleanup jobs (expired invite codes, etc.)
# - default: Fallback queue for other jobs
#
# Settings:
# - tries=3: Retry failed jobs up to 3 times
# - timeout=120: Max 2 minutes per job
# - sleep=3: Wait 3 seconds between job checks
# - max-time=3600: Restart worker after 1 hour (memory management)
# - numprocs=2: Run 2 worker processes for load balancing
#
# Monitoring:
# - View logs: tail -f /home/forge/noobz.space/storage/logs/queue-worker.log
# - Check status: sudo supervisorctl status
# - Restart: sudo supervisorctl restart noobz-queue-worker:*
# - Stop: sudo supervisorctl stop noobz-queue-worker:*
#
# Security:
# - Runs as 'forge' user (Laravel Forge standard)
# - Isolated process per worker
# - Automatic restart on failure
# - Log rotation enabled (10MB max, 5 backups)
